- name: Install and configure mysql on target2
  hosts: target2
  become: yes
  vars:
    db_name: mydb
    db_user: myuser
    db_pass: mypass
  tasks:
    - name: Install aptitude
      apt:
        name: aptitude
        state: present
        update_cache: yes
    - name: Install mysql-server
      apt:
        name: mysql-server
        state: present
    - name: Create database
      mysql_db:
        name: "{{ db_name }}"
        state: present
    - name: Create user
      mysql_user:
        name: "{{ db_user }}"
        password: "{{ db_pass }}"
        priv: "{{ db_name }}.*:ALL"
        state: present
    - name: Enable ufw
      ufw:
        state: enabled
    - name: Allow ssh
      ufw:
        rule: allow
        name: ssh
        proto: tcp
    - name: Allow mysql
      ufw:
        rule: allow
        port: 3306
        proto: tcp
